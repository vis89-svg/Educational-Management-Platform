<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mark Attendance</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    function loadStudents() {
      document.getElementById('filterForm').submit();
    }
  </script>
</head>
<body class="bg-light">
<div class="container mt-5">
  <h3 class="mb-4">Mark Attendance</h3>

  <form id="filterForm" method="get" class="row g-3 mb-4">
    <div class="col-md-4">
      <label class="form-label">Class</label>
      <select name="class_id" class="form-select" onchange="loadStudents()" required>
        <option value="">-- Select Class --</option>
        {% for course in courses %}
          <option value="{{ course.id }}" {% if course.id|stringformat:"s" == selected_class %}selected{% endif %}>
            {{ course.class_name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Date</label>
      <input type="date" name="date" class="form-control" value="{{ selected_date|default:today }}" required>
    </div>


  </form>

  {% if students %}
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="class_id" value="{{ selected_class }}">
    <input type="hidden" name="date" value="{{ selected_date|default:today }}">

    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Student</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td>{{ student.name }}</td>
          <td>
            <select name="attendance_{{ student.id }}" class="form-select">
              <option value="present" {% if student.attendance_status == "present" %}selected{% endif %}>Present</option>
              <option value="absent" {% if student.attendance_status == "absent" %}selected{% endif %}>Absent</option>
            </select>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button class="btn btn-success" type="submit">Save Attendance</button>
  </form>
  {% else %}
    <p class="text-muted">Select a class and date to load students.</p>
  {% endif %}
</div>
</body>
</html>
